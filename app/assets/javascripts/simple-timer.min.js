!function(t){var e,n=function(t){return this.targetElement=t,this};n.start=function(t,r){return e=new n(r),e.start(t)},n.prototype.start=function(n){var r=function(t){var e=document.createElement("span");e.className="seconds";var n=document.createElement("span");n.className="minutes";var r=document.createElement("span");r.className="hours";var o=document.createElement("div");return o.className="clearDiv",t.append(r).append(n).append(e).append(o)};this.targetElement.each(function(o,i){var a=t(i),s=a.attr("class");return a.on("complete",function(){clearInterval(a.intervalId)}),a.on("complete",function(){a.onComplete(a)}),a.on("complete",function(){a.addClass("timeout")}),a.on("complete",function(){n&&n.loop===!0&&e.resetTimer(a,n,s)}),r(a),this.startCountdown(a,n)}.bind(this))},n.prototype.resetTimer=function(t,n,r){var o=0;n.loopInterval&&(o=1e3*parseInt(n.loopInterval,10)),setTimeout(function(){t.trigger("reset"),t.attr("class",r+" loop"),e.startCountdown(t,n)},o)},n.prototype.fetchSecondsLeft=function(t){var e=t.data("seconds-left"),n=t.data("minutes-left");if(e)return parseInt(e,10);if(n)return 60*parseFloat(n);throw"Missing time data"},n.prototype.startCountdown=function(t,e){e=e||{};var n=null,r=function(){return clearInterval(n),this.clearTimer(t)}.bind(this);t.onComplete=e.onComplete||r;var o=this.fetchSecondsLeft(t),i=e.refreshRate||1e3,a=o+this.currentTime(),s=a-this.currentTime();this.setFinalValue(this.formatTimeLeft(s),t),n=setInterval(function(){s=a-this.currentTime(),this.setFinalValue(this.formatTimeLeft(s),t)}.bind(this),i),t.intervalId=n},n.prototype.clearTimer=function(t){t.find(".seconds").text("00"),t.find(".minutes").text("00:"),t.find(".hours").text("00:")},n.prototype.currentTime=function(){return Math.round((new Date).getTime()/1e3)},n.prototype.formatTimeLeft=function(t){var e,n,r,o,i=function(t,e){e=e||2,t+="";var n=null;return n=t.length>=e?t:Array(e-t.length+1).join(0)+t};return r=new Date(1e3*t),e=r.getUTCHours(),n=r.getUTCMinutes(),o=r.getUTCSeconds(),0===+e&&0===+n&&0===+o?[]:[i(e),i(n),i(o)]},n.prototype.setFinalValue=function(t,e){return 0===t.length?(this.clearTimer(e),e.trigger("complete"),!1):(e.find(".seconds").text(t.pop()),e.find(".minutes").text(t.pop()+":"),void e.find(".hours").text(t.pop()+":"))},t.fn.startTimer=function(t){return n.start(t,this),this}}(jQuery);
