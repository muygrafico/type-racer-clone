$(document).ready(function(){var e=function(e){e.val("")},t=function(e){return array=$(e).text().split(" ")},s=function(e,s){this.keystrokeCounter=0,this.points=0,this.time=0,this.user_id=$(".userData").data("user"),this.viewableNextWords=12,this.strings=t(s),this.next_words_p=e,this.viewHelper(e)};s.prototype={checkWord:function(e,t){return t=t.replace(/\s/g,""),e==t?!0:!1},word_to_array:function(e){return array=$(e).text().split(" ")},sendGameData:function(e){$.ajax({url:"/races",type:"POST",data:e})},limitView:function(){this.stringsLength=this.strings.length,this.stringsLength-this.points<this.viewableNextWords&&(this.viewableNextWords=this.stringsLength-this.points,this.viewableNextWords<1&&($(".timer").html("YOU FINISHED"),$("#gameInput").prop("disabled",!0),this.elapsed=this.stop(),this.accuracy=i($("#gameText").text().length,this.keystrokeCounter),wpm=Math.round(this.stringsLength/(this.elapsed/60)),$("#sec").html("WPM: "+wpm),this.item={race:{wpm:wpm,accuracy:this.accuracy,finished_time:this.elapsed,user_id:this.user_id}},this.sendGameData(this.item),$(".new-game").removeClass("hide")))},viewHelper:function(){var e="";this.limitView();for(var t=0;t<this.viewableNextWords;t++)e+=0==t?"<strong>"+this.strings[this.points+t]+"</strong> ":this.strings[this.points+t]+" ";$(this.next_words_p).html(e)},start:function(){clearInterval(this.timer);var e=this;e.time=0,this.timer=setInterval(function(){e.time+=1e3,e.elapsed=Math.floor(e.time/1e3)/1,$("#sec").html(e.elapsed+" <span class='small'>sec</span>")},1e3)},stop:function(){return clearInterval(this.timer),elapsed=Math.floor(this.time/1e3)/1,elapsed},counterBack:function(){}};var i=function(e,t){var s=e-(t-e);return part2=s/e,(100*part2).toFixed(2)};$("#gameInput").keyup(function(t){16!=t.which&&8!=t.which&&userRace.keystrokeCounter++;var s=$(this).val();word_validator=userRace.checkWord(userRace.strings[userRace.points],s),userRace.viewHelper(),32==t.which&&1!=userRace.viewableNextWords?1==word_validator&&(e($(this)),userRace.points++,userRace.viewHelper()):1==userRace.viewableNextWords&&1==word_validator&&(e($(this)),userRace.points++,userRace.viewHelper())}),$("#gameInput").attr("placeholder","Type the text above"),$("#gameInput").prop("disabled",!0),$(".timer").startTimer({onComplete:function(e){e.addClass("is-complete"),$(".timer").html("START!"),$("#gameInput").prop("disabled",!1),$("#gameInput").focus(),userRace=new s(".next-word","#gameText",$("#gameText").length),userRace.start()}})});
