$(document).ready(function(){console.log("ChuckType Engine V0.3b");var c=function(e){e.val("")};var a=function(f,e){this.keystrokeCounter=0;this.points=0;this.time=0;this.user_id=document.getElementsByClassName("userData")[0].getAttribute("data-user");this.viewableNextWords=12;this.strings=this.word_to_array(e);this.next_words=f;this.viewHelper(f)};a.prototype={checkWord:function(f,e){e=e.replace(/\s/g,"");if(f==e){return true}else{return false}},word_to_array:function(e){return array=document.getElementById(e).innerHTML.split(" ")},sendGameData:function(e){$.ajax({url:"/races",type:"POST",data:e})},limitView:function(){this.stringsLength=this.strings.length;if(this.stringsLength-this.points<this.viewableNextWords){this.viewableNextWords=this.stringsLength-this.points;if(this.viewableNextWords<1){document.getElementsByClassName("timer").innerHTML="YOU FINISHED";$("#gameInput").prop("disabled",true);this.elapsed=this.stop();this.accuracy=d($("#gameText").text().length,this.keystrokeCounter);wpm=Math.round((this.stringsLength/(this.elapsed/60)));$("#sec").html("WPM: "+wpm);this.item={race:{wpm:wpm,accuracy:this.accuracy,finished_time:this.elapsed,user_id:this.user_id}};this.sendGameData(this.item);$(".new-game").removeClass("hide")}}},viewHelper:function(){var f="";this.limitView();for(var e=0;e<this.viewableNextWords;e++){if(e==0){f+="<strong>"+this.strings[this.points+e]+"</strong> "}else{f+=this.strings[this.points+e]+" "}}$(this.next_words).html(f)},start:function(){clearInterval(this.timer);var e=this;e.time=0;this.timer=setInterval(function(){e.time+=1000;e.elapsed=Math.floor(e.time/1000)/1;$("#sec").html(e.elapsed+" <span class='small'>sec</span>")},1000)},stop:function(){clearInterval(this.timer);elapsed=Math.floor(this.time/1000)/1;return elapsed},counterBack:function(e){}};function b(e){return(parseFloat(e.toPrecision(12)))}var d=function(f,e){var g=f-(e-f);part2=g/f;return(part2*100).toFixed(2)};$("#gameInput").keypress(function(f){console.log("keypress");if(f.which!=16&&f.which!=8){userRace.keystrokeCounter++}var g=$(this).val();if(f.which==32&&userRace.viewableNextWords!=1||userRace.viewableNextWords==1){word_validator=userRace.checkWord(userRace.strings[userRace.points],g);if(word_validator){c($(this));userRace.points++;userRace.viewHelper()}}});$("#gameInput").attr("placeholder","Type the text above");$("#gameInput").prop("disabled",true);$(".timer").startTimer({onComplete:function(e){e.addClass("is-complete");$(".timer").html("START!");$("#gameInput").prop("disabled",false);$("#gameInput").focus();userRace=new a(".next-word","gameText",$("#gameText").length);userRace.start()}})});
